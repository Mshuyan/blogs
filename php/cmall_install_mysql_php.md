#【原始配置】
### nginx
```
/usr/local/nginx/conf
```
```
    upstream php5.4 {
      server   unix:/dev/shm/php-fpm/php-fpm.sock;
    }

    upstream php5.3 {
      server   unix:/dev/shm/php-fpm/php-fpm5.3.sock;
    }
```
### php_
```
/usr/local/php/etc
```
```
/usr/local/php/etc
[root@localhost etc]# ll
total 172
-rw-r--r--. 1 root root  1152 Mar 13  2015 pear.conf
-rw-r--r--. 1 root root 21975 Mar 16  2015 php-fpm1.conf
-rw-r--r--. 1 root root 21972 Mar 16  2015 php-fpm20170919.conf
-rw-r--r--  1 root root 22016 Sep 19  2017 php-fpm.conf
-rw-r--r--. 1 root root 22236 Mar 13  2015 php-fpm.conf.default
-rw-r--r--. 1 root root 65817 Mar 28  2016 php.ini
[root@localhost etc]# 
```
```
[root@localhost bin]# ll
total 70644
-rwxr-xr-x. 1 root root      837 Mar 13  2015 pear
-rwxr-xr-x. 1 root root      858 Mar 13  2015 peardev
-rwxr-xr-x. 1 root root      774 Mar 13  2015 pecl
lrwxrwxrwx. 1 root root       28 Sep 10  2016 phar -> /usr/local/php/bin/phar.phar
-rwxr-xr-x. 1 root root    14827 Mar 13  2015 phar.phar
-rwxr-xr-x. 1 root root 36136339 Mar 13  2015 php
-rwxr-xr-x. 1 root root 36074976 Mar 13  2015 php-cgi
-rwxr-xr-x. 1 root root     3171 Mar 13  2015 php-config
-rwxr-xr-x. 1 root root     4534 Mar 13  2015 phpize
[root@localhost bin]# 
[root@localhost bin]# cd ..
[root@localhost php]# ll
total 28
drwxr-xr-x. 2 root root 4096 Mar 13  2015 bin
drwxr-xr-x. 2 root root 4096 Sep 19  2017 etc
drwxr-xr-x. 3 root root 4096 Mar 13  2015 include
drwxr-xr-x. 3 root root 4096 Mar 13  2015 lib
drwxr-xr-x. 4 root root 4096 Mar 13  2015 php
drwxr-xr-x. 2 root root 4096 Mar 13  2015 sbin
drwxr-xr-x. 4 root root 4096 Mar 13  2015 var
[root@localhost php]# cd sbin
[root@localhost sbin]# ll
total 35760
-rwxr-xr-x. 1 root root 36573466 Mar 13  2015 php-fpm
[root@localhost sbin]# 
[root@localhost sbin]# 
[root@localhost sbin]# pwd
/usr/local/php/sbin
[root@localhost sbin]#
```
### memcached
```
[root@localhost ~]# 
[root@localhost ~]# ps -ef | grep memca
root     19837 19749  0 10:23 pts/4    00:00:00 grep memca
root     30923     1  0 Feb27 ?        00:08:12 /usr/bin/memcached -b -l 127.0.0.1 -p 11211 -m 150 -u root
[root@localhost ~]# 
```

### /usr/local
```
[root@localhost bin]# cd /usr/local
[root@localhost local]# ll
total 84
drwxr-xr-x.  2 root root 4096 Sep 12  2017 bin
drwxr-xr-x.  5 root root 4096 Sep 20  2014 cronolog
drwxr-xr-x.  2 root root 4096 Sep 23  2011 etc
drwxr-xr-x.  2 root root 4096 Sep 23  2011 games
drwxr-xr-x.  7 root root 4096 Mar 13  2015 imagemagick
drwxr-xr-x.  2 root root 4096 Sep 23  2011 include
drwxr-xr-x.  2 root root 4096 Sep 23  2011 lib
drwxr-xr-x.  2 root root 4096 Sep 23  2011 lib64
drwxr-xr-x.  2 root root 4096 Sep 23  2011 libexec
drwxr-xr-x.  6 root root 4096 Mar 13  2015 libiconv
drwxr-xr-x.  7 root root 4096 Mar 13  2015 libmcrypt
drwxr-xr-x.  5 root root 4096 Mar 13  2015 memcached
drwxr-xr-x   3 root root 4096 Sep 13  2017 mysql
drwxr-xr-x.  8 root root 4096 Sep 22  2017 nginx
drwxr-xr-x.  9 root root 4096 Mar 16  2015 php
drwxr-xr-x. 10 root root 4096 Jan  5  2016 php5.3
drwxr-xr-x. 10 root root 4096 Sep 20  2014 proftpd
drwxr-xr-x.  2 root root 4096 Sep 23  2011 sbin
drwxr-xr-x.  6 root root 4096 Mar 13  2015 scws
drwxr-xr-x.  5 root root 4096 Jan 17  2018 share
drwxr-xr-x.  3 root root 4096 Feb 27 13:57 src
[root@localhost local]# 
```
#【二 重新安装】
# mysql install
```
wget https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-5.7.23-el7-x86_64.tar.gz
tar xvf mysql-5.7.23-el7-x86_64.tar.gz
mv mysql-5.7.23-el7-x86_64 /usr/local/mysql5.7.23
```
查看 my.cnf
```
[root@dev bin]# ./mysql --help|grep 'my.cnf'
                      order of preference, my.cnf, $MYSQL_TCP_PORT,
/etc/my.cnf /etc/mysql/my.cnf /usr/local/mysql/etc/my.cnf ~/.my.cnf 
[root@dev bin]# 
[root@dev bin]# pwd
/usr/local/mysql5.7.23/bin
[root@dev bin]# 
```
#### 参考 
```
* https://www.jb51.net/article/135995.htm

mkdir /usr/local/mysql3308
chown -R mysql.mysql /usr/local/mysql3308/
mkdir -p /data/mysql3308
chown -R mysql.mysql /data/mysql3308
mkdir -p /home/data/mysql3308/binlog
chown -R mysql.mysql /home/data/mysql3308

```
#### cat /etc/my.cnf
```
[root@dev php-5.6.37]# cat /etc/my.cnf
# for advice on how to change settings please see
# http://dev.mysql.com/doc/refman/5.6/en/server-configuration-defaults.html
# *** DO NOT EDIT THIS FILE. It's a template which will be copied to the
# *** default location during install, and will be replaced if you
# *** upgrade to a newer version of MySQL.
[mysqld_multi]
user=root
pass=123456
mysqld = /usr/local/mysql5.7.23/bin/mysqld_safe
mysqladmin =/usr/local/mysql5.7.23/bin/mysqladmin
log =/var/log/mysqld_multi.log
[mysqld1]
socket = /usr/local/mysql3307/mysql.sock
port = 3307
pid-file = /usr/local/mysql3307/mysql.pid
datadir = /data/mysql3307
log_bin=/home/data/mysql3307/binlog
server-id = 1
innodb_buffer_pool_size = 128M
innodb_flush_log_at_trx_commit = 0
[mysqld2]
socket = /usr/local/mysql3308/mysql.sock
port = 3308
pid-file = /usr/local/mysql3308/mysql.pid
datadir = /data/mysql3308
log_bin=/home/data/mysql3308/binlog
server-id = 2
innodb_buffer_pool_size = 128M
innodb_flush_log_at_trx_commit = 0

[root@dev php-5.6.37]# 
```

#### 
```
[root@dev support-files]# /usr/local/mysql5.7.23/bin/mysqld --initialize --user=mysql --basedir=/usr/local/mysql5.7.23 --datadir=/data/mysql3308 --explicit_defaults_for_timestamp=1
2018-08-24T05:35:06.188996Z 0 [Warning] InnoDB: New log files created, LSN=45790
2018-08-24T05:35:06.884259Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.
2018-08-24T05:35:06.995799Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: 75819245-a75f-11e8-8460-6c92bf0a0d8b.
2018-08-24T05:35:07.005731Z 0 [Warning] Gtid table is not ready to be used. Table 'mysql.gtid_executed' cannot be opened.
2018-08-24T05:35:07.006663Z 1 [Note] A temporary password is generated for root@localhost: yh/&6&W0lld2
[root@dev support-files]# 
```

#### ./mysqld_multi --defaults-extra-file=/etc/my.cnf start 2
```
[root@dev bin]# ./mysqld_multi --defaults-extra-file=/etc/my.cnf start 2                          
WARNING: my_print_defaults command not found.
Please make sure you have this command available and
in your path. The command is available from the latest
MySQL distribution.
ABORT: Can't find command 'my_print_defaults'.
This command is available from the latest MySQL
distribution. Please make sure you have the command
in your PATH.
[root@dev bin]# 
/usr/local/mysql5.7.23/bin
[root@dev bin]# export PATH=/usr/local/mysql5.7.23/bin:$PATH
[root@dev bin]# ./mysqld_multi --defaults-extra-file=/etc/my.cnf start 2
[root@dev bin]# 
```


#### mysql --socket=/usr/local/mysql3308/mysql.sock -uroot -p
```
[root@dev bin]# netstat -lntp -lntp
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:111             0.0.0.0:*               LISTEN      1/systemd           
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      4284/nginx: master  
tcp        0      0 0.0.0.0:20160           0.0.0.0:*               LISTEN      1009/sshd           
tcp        0      0 127.0.0.1:9000          0.0.0.0:*               LISTEN      15286/php-fpm: mast 
tcp6       0      0 :::3306                 :::*                    LISTEN      12315/mysqld        
tcp6       0      0 :::3308                 :::*                    LISTEN      29610/mysqld        
tcp6       0      0 :::111                  :::*                    LISTEN      1/systemd           
[root@dev bin]# 
[root@dev bin]# mysql --socket=/usr/local/mysql3308/mysql.sock
ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)
[root@dev bin]# 
[root@dev bin]# mysql --socket=/usr/local/mysql3308/mysql.sock -uroot -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 3
Server version: 5.7.23-log

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> 
mysql> show databases;
ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.
mysql> 
mysql> 
mysql> 
mysql> alter user 'root'@'localhost' identified by '123456';
Query OK, 0 rows affected (0.11 sec)

mysql> 
mysql>
```
#### mysqld_multi --defaults-extra-file=/etc/my.cnf stop 2   
```
[root@dev bin]# mysqld_multi --defaults-extra-file=/etc/my.cnf stop 2   
[root@dev bin]# 
[root@dev bin]# mysqld_multi --defaults-extra-file=/etc/my.cnf report   
Reporting MySQL servers
MySQL server from group: mysqld1 is not running
MySQL server from group: mysqld2 is not running
[root@dev bin]# 
```
# php install
* http://www.php.net/releases/
以上这里可以下载各种版本！！！


* http://php.net/manual/zh/install.unix.nginx.php
* https://www.cnblogs.com/scofi/articles/5135459.html
```
 1001  cd software/
 1002  ll
 1003  wget http://us1.php.net/get/php-5.6.37.tar.gz/from/this/mirror
 1004  ll
 1005  mv mirror php-5.6.37.tar.gz
 1006  ll
 1007  tar xvf php-5.6.37.tar.gz 
 1008  ll
 1009  cd php-5.6.37
 1010  ll
 1011  ls
 1012  ./configure --enable-fpm --with-mysql
 1013  ll
 1014  make
 1015  yum -y install gcc make gd-devel libjpeg-devel libpng-devel libxml2-devel bzip2-devel libcurl-devel libaio
 1016  yum install libmcrypt-devel
 1017  yum install php-mcrypt
  yum  install epel-release 
  
 1018  yum groupinstall "Development tools"
 1019  cat /etc/my.cnf
 1020   history
[root@dev php-5.6.37]# 
```
#### [root@dev php-5.6.37]# ./configure --help
好参考！！
* https://www.cnblogs.com/scofi/articles/5135459.html
查看 php 编译选项
* https://blog.csdn.net/eclothy/article/details/45148313

``` 
 1021  wget  http://mirror.hust.edu.cn/gnu/libiconv/libiconv-1.10.tar.gz
 1022  l
 1023  ll
 1024  tar xvf libiconv-1.10.tar.gz 
 1025  cd libiconv-1.10
 1026  ll
 1027  ls
 1028  ./configure
 1029  make
 1030  make install
```

```
[root@dev php-5.6.37]# cat zz1.sh
./configure  --prefix=/usr/local/php-5.6.37 --with-config-file-path=/usr/local/php-5.6.37/etc --with-iconv=/usr/local/libiconv --enable-fpm --with-libxml-dir --with-zlib --with-curl --enable-dba --enable-ftp --with-freetype-dir --with-gd --with-jpeg-dir --with-png-dir --with-zlib-dir --enable-gd-native-ttf --with-gettext --enable-mbstring --with-mcrypt --with-mysql --with-mysqli --enable-pcntl --with-pdo-mysql --without-pdo-sqlite --enable-shmop --enable-sockets --enable-sysvmsg --enable-sysvsem --enable-sysvshm --enable-zip

[root@dev php-5.6.37]# 
```

```
make
make install
```
安装完成后
```
[root@dev php-5.6.37]# ll
total 4
drwxr-xr-x. 2 root root 4096 Aug 25 11:15 bin
drwxr-xr-x. 2 root root   33 Aug 25 11:15 etc
drwxr-xr-x. 3 root root   16 Aug 25 11:15 include
drwxr-xr-x. 3 root root   16 Aug 25 11:15 lib
drwxr-xr-x. 4 root root   26 Aug 25 11:15 php
drwxr-xr-x. 2 root root   20 Aug 25 11:15 sbin
drwxr-xr-x. 4 root root   26 Aug 25 11:15 var
[root@dev php-5.6.37]#
```
在etc目录下有一个文件：php-fpm.conf.default

### 以前的PHP PHP 5.4.16 
```
[root@dev bin]#  cd 
[root@dev ~]# php -v
PHP 5.4.16 (cli) (built: Apr 12 2018 19:02:01) 
Copyright (c) 1997-2013 The PHP Group
Zend Engine v2.4.0, Copyright (c) 1998-2013 Zend Technologies
[root@dev ~]# 
[root@dev ~]# php -m
[PHP Modules]
bz2
calendar
Core
ctype
date
ereg
exif
filter
ftp
gettext
gmp
hash
iconv
libxml
mhash
openssl
pcntl
pcre
readline
Reflection
session
shmop
SimpleXML
sockets
SPL
standard
tokenizer
xml
zlib

[Zend Modules]

[root@dev ~]# 
```
### 现在的PHP  PHP 5.6.37
```
[root@dev bin]# ./php -v
PHP 5.6.37 (cli) (built: Aug 25 2018 10:15:33) 
Copyright (c) 1997-2016 The PHP Group
Zend Engine v2.6.0, Copyright (c) 1998-2016 Zend Technologies
[root@dev bin]# ./php -m
[PHP Modules]
Core
ctype
curl
date
dba
dom
ereg
fileinfo
filter
ftp
gd
gettext
hash
iconv
json
libxml
mbstring
mcrypt
mysql
mysqli
mysqlnd
pcntl
pcre
PDO
pdo_mysql
Phar
posix
Reflection
session
shmop
SimpleXML
sockets
SPL
sqlite3
standard
sysvmsg
sysvsem
sysvshm
tokenizer
xml
xmlreader
xmlwriter
zip
zlib

[Zend Modules]

[root@dev bin]# 
```

# php-fpm 配置 启动
* http://www.4wei.cn/archives/1002061

* /usr/local/php-5.6.37/etc
```
[root@dev php-5.6.37]# cd ./etc
[root@dev etc]# ll
total 168
-rw-r--r--. 1 root root  1152 Aug 25 12:10 pear.conf
-rw-r--r--. 1 root root 21975 Aug 25 12:10 php-fpm1.conf
-rw-r--r--. 1 root root 21972 Aug 25 12:10 php-fpm20170919.conf
-rw-r--r--. 1 root root 22025 Aug 25 12:19 php-fpm.conf
-rw-r--r--. 1 root root 22236 Aug 25 12:10 php-fpm.conf.default
-rw-r--r--. 1 root root 65817 Aug 25 12:10 php.ini
[root@dev etc]# 
```
php-fpm.conf的配置：
```
php-fpm.conf:listen = /dev/shm/php-fpm/php-fpm.sock
```


* /usr/local/php-5.6.37/sbin/php-fpm
```
[root@dev etc]# cd ../sbin
[root@dev sbin]# ll
total 37168
-rwxr-xr-x. 1 root root 38058912 Aug 25 11:15 php-fpm
[root@dev sbin]# 
[root@dev sbin]# pwd
/usr/local/php-5.6.37/sbin
[root@dev sbin]# 
```
### nginx 配置
* 
```
cp server* /usr/local/nginx-1.14.0/conf
[root@dev conf]# cd -
/var/www/backup_20180824/nginx/conf
[root@dev conf]# 
cp nginx.conf /usr/local/nginx-1.14.0/conf
```
```
#/nginx.conf;
error_log  /var/log/nginx/error.log error;
pid        /var/log/nginx/nginx.pid;

    upstream php5.4 {
      server   unix:/dev/shm/php-fpm/php-fpm.sock;
    }

    upstream php5.3 {
      server   unix:/dev/shm/php-fpm/php-fpm5.3.sock;
    }
````
### 【mall_configure 】
```
[root@dev data]# vi  config.inc.a.php
<?php

return array (
  'SITE_URL' => 'http://www.henrongyi.com',
  'DB_CONFIG' => 'mysql://ecmalldbuser:5t8c93nmc4@localhost:3306/ecmall',
  'DB_PREFIX' => 'ecm_',
  'LANG' => 'sc-utf-8',
  'COOKIE_DOMAIN' => '',
  'COOKIE_PATH' => '/',
  'ECM_KEY' => '749bf8a5fd09c7c18a12f33a69fea5f8',
  'MALL_SITE_ID' => 'EMNDHNmc1a6DGqJB',
  'ENABLED_GZIP' => 0,
  'DEBUG_MODE' => 0,
  'CACHE_SERVER' => 'default',
  'MEMBER_TYPE' => 'default',
  'ENABLED_SUBDOMAIN' => 0,
  'SUBDOMAIN_SUFFIX' => '',
  'SESSION_TYPE' => 'mysql',
  'SESSION_MEMCACHED' => 'localhost:11211',
  'CACHE_MEMCACHED' => 'localhost:11211',
);

?>
```

### 【导入数据库】
有意思，用localhost不行，用127.0.0.1可以。
/etc/profile
```
unset i
unset -f pathmunge
export PATH=/root/anaconda3/bin:$PATH
export PATH=/usr/local/mysql5.7.23/bin:$PATH
[root@dev ~]# 
```

测试数据库的连接
```
  990  mysql --socket=/usr/local/mysql3308/mysql.sock -uroot -p
  991  ./mysql --socket=/usr/local/mysql3308/mysql.sock -uroot -p
  992  ps -ef | grep mysql
  993  ./mysqld_multi --defaults-extra-file=/etc/my.cnf start 2
  996  ./mysqld_multi --defaults-extra-file=/etc/my.cnf start 2
 1001  cd /usr/local/mysql5.7.23/
 1004  mysqld_multi --defaults-extra-file=/etc/my.cnf start 2
 1005  ./mysql -u root -P 3308  -p
 1006  mysqld_multi --defaults-extra-file=/etc/my.cnf report   
 1009   ./mysql --socket=/usr/local/mysql3308/mysql.sock -uroot -p
```

```
[root@dev bin]# ./mysql -u root -P 3308  -p
Enter password: 
ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)
[root@dev bin]# 
[root@dev bin]# 
[root@dev bin]# ./mysql -u root -P 3308  -p -h127.0.0.1
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 5
Server version: 5.7.23-log MySQL Community Server (GPL)

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> 

```
导入数据库
```
mysql> 
mysql> source /var/www/backup_20180824/ecmalltaoruanjian.sql
```
